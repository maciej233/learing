from distutils.cmd import Command
import paramiko
import getpass
import json

pkey = "~/.ssh/id_rsa.pub"
def ssh_single_command(ip, port, username, password, cmd):
    connection = paramiko.SSHClient()
    connection.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    connection.connect(ip, port, username, password, allow_agent=False, look_for_keys=False)

    ssh = connection.invoke_shell()
    ssh.send(cmd)

def main():
    username = input("Username: ")
    password = getpass.getpass("Password: ")
    port = 22
    with open("devices.json", 'r') as f:
        devices = json.load(f)
        for device in devices.keys():
            ip = devices[device]['ip']
            with open('commands.txt', 'r') as f:
                commands = f.readlines()
                for command in commands:
                    ssh_single_command(ip, port, username, password, command)


if __name__ == "__main__":
    main()